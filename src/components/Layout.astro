---
const { date, prev, next, posts, showCanonical = false, latestDate } = Astro.props;
const isToday = date === new Date().toISOString().split('T')[0];
const nextLink = next === latestDate ? '/' : `/${next}`;
const currentYear = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>8am Coffee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/global.css" />
    {showCanonical && <link rel="canonical" href="https://8am.coffee/" />}
  </head>
  <body>
    <!-- …contenido sin cambios… -->

    <script src="/inject-banner.js" defer></script>

    <!-- Mixpanel: carga + init + page-view cuando el SDK termina -->
    <script
      src="https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"
      onload="
        mixpanel.init('28f8ba184732934626a5fc5de430e0ed', { debug: false });
        mixpanel.track('Page View', {
          path: window.location.pathname,
          referrer: document.referrer || 'direct'
        });
      "
    ></script>

    <!-- Eventos de navegación y “Read more” (se ejecutan tras DOMContentLoaded) -->
    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        // Prev / Next buttons
        document.getElementById('prevBtn')?.addEventListener('click', () =>
          mixpanel.track('Nav Click', { direction: 'previous', path: location.pathname })
        );
        document.getElementById('nextBtn')?.addEventListener('click', () =>
          mixpanel.track('Nav Click', { direction: 'next', path: location.pathname })
        );

        // Delegate Read-more clicks
        document.body.addEventListener('click', (e) => {
          const link = e.target.closest('a.read-more');
          if (!link) return;
          mixpanel.track('Read More', {
            slug: link.dataset.slug,
            title: link.dataset.title,
            path: location.pathname
          });
        });
      });
    </script>
  </body>
</html>
