---
import posts from '../data/posts-public.json';

const { date: currentDate } = Astro.props;
const filteredPosts = posts.filter(p => new Date(p.date).toISOString().split("T")[0] === currentDate);
const showBanner = filteredPosts.length >= 3;

// Partimos los posts
const firstTwo = filteredPosts.slice(0, 2);
const remaining = filteredPosts.slice(2);

// Definimos funciÃ³n para mostrar fecha corta
const formatDate = (dateStr) => new Date(dateStr).toISOString().split("T")[0];
---

<section class="post-list">
  {firstTwo.map(post => (
    <article class="post">
      <small>{formatDate(post.date)}</small>
      <h2>{post.title}</h2>
      {post.summary && <p>{post.summary}</p>}
      {post.url_origin && (
        <a href={post.url_origin} class="read-more" target="_blank" rel="noopener noreferrer">
          Read more â†’
        </a>
      )}
    </article>
  ))}

  {showBanner && (
    <div class="telegram-banner">
      <img src="/telegram-icon.png" alt="Telegram" />
      <div>
        <strong>ðŸ“¢ Donâ€™t miss the latest IA news!</strong>
        <p>Get your 8am Coffee updates, every day. <a href="#">Join our community!</a></p>
      </div>
      <a class="cta" href="#" target="_blank" rel="noopener noreferrer">Join NOW for free!</a>
    </div>
  )}

  {remaining.map(post => (
    <article class="post">
      <small>{formatDate(post.date)}</small>
      <h2>{post.title}</h2>
      {post.summary && <p>{post.summary}</p>}
      {post.url_origin && (
        <a href={post.url_origin} class="read-more" target="_blank" rel="noopener noreferrer">
          Read more â†’
        </a>
      )}
    </article>
  ))}
</section>
